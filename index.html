<!-- Shortie - Telegram Mini App HTML UI with Full Integration -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shortie</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    .like-animate {
      animation: pop 0.3s ease;
    }
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="w-full max-w-md mx-auto">
    <!-- Top Bar with Search and Notification -->
    <div class="flex justify-between items-center px-4 py-2 bg-white shadow">
      <input type="text" placeholder="ğŸ” Search" class="border px-2 py-1 rounded w-2/3" id="search-input">
      <div class="relative">
        <button onclick="navigate('notifications')">ğŸ””</button>
        <span id="notification-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1 hidden">0</span>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="fixed bottom-0 left-0 w-full bg-white border-t flex justify-around py-2 z-10">
      <button onclick="navigate('home')">ğŸ </button>
      <button onclick="navigate('upload')">â•</button>
      <button onclick="navigate('inbox')">ğŸ’¬</button>
      <button onclick="navigate('wallet')">ğŸ’°</button>
      <button onclick="navigate('profile')">ğŸ‘¤</button>
    </div>

    <!-- Screens -->
    <div id="home" class="screen p-4"> 
      <h2 class="text-xl font-bold mb-2">ğŸ¥ Feed</h2>
      <div id="video-feed" class="space-y-4"></div>
    </div>

    <div id="upload" class="screen p-4 hidden">
      <h2 class="text-xl font-bold mb-2">â• Upload</h2>
      <input type="file" id="video-file" accept="video/*" class="mb-2">
      <input type="text" id="music-id" placeholder="Music ID (optional)" class="border p-1 mb-2 w-full">
      <button onclick="uploadVideo()" class="bg-blue-500 text-white px-4 py-1 rounded">Upload</button>
    </div>

    <div id="inbox" class="screen p-4 hidden">
      <h2 class="text-xl font-bold mb-2">ğŸ’¬ Inbox</h2>
      <div id="chat-box" class="h-60 overflow-y-auto border mb-2 p-2"></div>
      <input type="text" id="chat-message" class="border p-1 w-full" placeholder="Type a message...">
      <button onclick="sendMessage()" class="mt-2 bg-green-500 text-white px-3 py-1 rounded">Send</button>
    </div>

    <div id="wallet" class="screen p-4 hidden">
      <h2 class="text-xl font-bold mb-2">ğŸ’° Wallet</h2>
      <p>Balance: <span id="balance">0</span> coins</p>
      <button onclick="requestWithdraw()" class="mt-2 bg-yellow-500 text-white px-3 py-1 rounded">Request Withdraw</button>
      <div id="income-history" class="mt-4"></div>
    </div>

    <div id="profile" class="screen p-4 hidden">
      <h2 class="text-xl font-bold mb-2">ğŸ‘¤ Profile</h2>
      <p>Your Telegram ID: <span id="tg-id"></span></p>
      <button onclick="navigate('admin')" class="mt-2 bg-purple-500 text-white px-3 py-1 rounded">Go to Admin Panel</button>
    </div>

    <div id="admin" class="screen p-4 hidden">
      <h2 class="text-xl font-bold mb-2">ğŸ§‘â€ğŸ’¼ Admin Panel</h2>
      <div class="flex gap-2 mb-2">
        <button onclick="filterWithdraws('pending')" class="bg-yellow-500 text-white px-2 rounded">Pending</button>
        <button onclick="filterWithdraws('approved')" class="bg-green-500 text-white px-2 rounded">Approved</button>
        <button onclick="filterWithdraws('rejected')" class="bg-red-500 text-white px-2 rounded">Rejected</button>
      </div>
      <div id="withdraw-requests"></div>
    </div>

    <div id="music" class="screen p-4 hidden">
      <h2 class="text-xl font-bold mb-2">ğŸµ Music Library</h2>
      <input type="text" id="music-title" placeholder="Title" class="border p-1 mb-2 w-full">
      <input type="file" id="music-file" accept="audio/*" class="mb-2">
      <button onclick="uploadMusic()" class="bg-indigo-500 text-white px-4 py-1 rounded">Upload Music</button>
      <div id="music-list" class="mt-4"></div>
    </div>

    <div id="notifications" class="screen p-4 hidden">
      <h2 class="text-xl font-bold mb-2">ğŸ”” Notifications</h2>
      <ul id="notification-list"></ul>
    </div>
  </div>

  <script>
    const supabase = supabase.createClient('https://ydtpzbwauxqxqouysaau.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkdHB6YndhdXhxeHFvdXlzYWF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxNjI0MjIsImV4cCI6MjA2NDczODQyMn0.mAUxZcqBLQdzOih6Ty2Eoy_vXmR94BwAcTCQ1j2_1M0');
    let tgUser;

    window.Telegram.WebApp.ready();
    tgUser = window.Telegram.WebApp.initDataUnsafe.user;
    document.getElementById('tg-id').innerText = tgUser.id;

    function navigate(tab) {
      document.querySelectorAll('.screen').forEach(div => div.classList.add('hidden'));
      document.getElementById(tab).classList.remove('hidden');
    }

    async function filterWithdraws(status) {
      const { data } = await supabase.from('withdraw_requests').select('*').eq('status', status);
      const panel = document.getElementById('withdraw-requests');
      panel.innerHTML = data.map(w => `
        <div class="border p-2 mb-2">
          <p>User: ${w.user_id}</p>
          <p>Amount: ${w.amount}</p>
          <p>Status: ${w.status}</p>
          ${w.status === 'pending' ? `
          <button onclick="updateWithdraw('${w.id}', 'approved')" class="bg-green-500 text-white px-2">Approve</button>
          <button onclick="updateWithdraw('${w.id}', 'rejected')" class="bg-red-500 text-white px-2">Reject</button>
          ` : ''}
        </div>
      `).join('');
    }

    async function loadAdminPanel() {
      if (tgUser.username !== 'riponmondol420') return;
      navigate('admin');
      filterWithdraws('pending');
    }

    async function updateWithdraw(id, status) {
      await supabase.from('withdraw_requests').update({ status }).eq('id', id);
      alert(`Withdraw ${status}`);
      filterWithdraws(status);
    }

    loadFeed();
    loadWallet();
    loadAdminPanel();
    loadNotifications();
  </script>
</body>
</html>
